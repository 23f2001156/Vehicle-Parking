<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Monthly Parking Report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; margin: 0; padding: 0; }
    .email-container { max-width: 600px; margin: auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #e9ecef; padding: 32px 24px; }
    .table { margin-bottom: 0; }
    .footer { font-size: 13px; color: #888; margin-top: 24px; text-align: center; }
    .brand { color: #0d6efd; font-weight: bold; }
  </style>
</head>
<body>
  <div class="email-container">
    <h2 class="mb-3 brand">ParkPal Parking - Monthly Report</h2>
    <p>Dear <b>{{ username }}</b>,</p>
    <p>Here is your parking summary{% if month %} for <b>{{ month }}</b>{% endif %}:</p>

    <table class="table table-bordered table-sm">
      <thead class="table-light">
        <tr>
          <th>Date</th>
          <th>Location</th>
          <th>Vehicle</th>
          <th>In</th>
          <th>Out</th>
          <th>Cost</th>
        </tr>
      </thead>
      <tbody>
        {% for r in user_reservations %}
        <tr>
          <td>
            {% if r.parking_time %}
              {% set date_parts = r.parking_time.split(' ') %}
              {{ date_parts[0] if date_parts|length > 0 else r.parking_time }}
            {% else %}
              -
            {% endif %}
          </td>
          <td>{{ r.location or '-' }}</td>
          <td>{{ r.vehicle or 'N/A' }}</td>
          <td>
            {% if r.parking_time %}
              {% set time_parts = r.parking_time.split(' ') %}
              {{ time_parts[1] if time_parts|length > 1 else r.parking_time }}
            {% else %}
              -
            {% endif %}
          </td>
          <td>
            {% if r.leaving_time %}
              {% set time_parts = r.leaving_time.split(' ') %}
              {{ time_parts[1] if time_parts|length > 1 else r.leaving_time }}
            {% else %}
              -
            {% endif %}
          </td>
          <td>${{ "%.2f"|format(r.cost) if r.cost else "0.00" }}</td>
        </tr>
        {% endfor %}
        {% if user_reservations|length == 0 %}
        <tr>
          <td colspan="6" class="text-center text-muted">No parking activity found.</td>
        </tr>
        {% endif %}
      </tbody>
    </table>

    <div class="mt-4">
      <b>Total Spent:</b> ${{ "%.2f"|format(total_cost) if total_cost else "0.00" }}
    </div>

    <div class="footer mt-4">
      Thank you for using <span class="brand">ParkPal Parking</span>.<br>
      For any queries, contact support at <a href="mailto:support@parkpal.com">support@parkpal.com</a>
    </div>
  </div>
</body>
</html>